# devops平台

devops平台是一个对项目全生命周期管理，以及研发过程全声明周期管理和监测的软件研发和运维平台。基本囊括以下能力：
1. 项目管理（创建项目、项目成员管理、项目权限管理、项目成员权限管理）
2. 版本控制（代码仓库管理、代码提交管理、代码审核管理、代码构建管理、代码发布管理）
2. 持续集成（常见于CI卡点, 单元测试，代码质量监测（lint）,覆盖率）
3. 持续交付（构建、发布、部署，日志监控，流量监控，性能监控，监控报警）

devops平台经常会和以下平台配合使用：
1. 代码仓库：gitlab、github、gitee、svn。
2. 构建工具：jenkins、gitlab-ci、github-actions。
3. 流水线管理：codeup pipeline。
4. 成员管理
5. 监控报警
6. 发布部署平台

## gitlab 实现
### 代码仓库
代码仓库是devops平台中一个很重要的模块，它提供了代码仓库的创建，分支管理，代码提交，代码审核等能力。
以企业经常使用的gitlib为例。通过使用gitlib-ci.yaml来配置项目的CI流水线。通常我们在项目的根目录下
创建一个.gitlab-ci.yaml文件，用来配置CI流水线。其中有几个比较重要的字段单独拿出来讲一下：
1. stages：流水线阶段，这个字段就是定义我们项目的流水线的阶段，比如构建、测试、发布等。
2. jobs：流水线任务，这个字段定义了我们每个阶段的任务。每个job定义的name必须是唯一的，其中每个job下都有对应的
script字段，这个字段定义了Runner执行的命令。其中还有一个stage字段，这个字段用于和上面的stages字段关联，即指明这个job属于那个阶段，job下还有一个比较重要的字段when，这个字段允许我们定义job的如何执行，默认情况下是当前一个任务执行完成之后后面的job开始执行，可以设置为always表示无论如何都执行或者on_failure表示上一个任务执行失败才执行，最后一个比较最重要的配置是manual,这个字段表示这个任务是否手动执行，大多情况下，CI完成之后就到了交付阶段，但到目前为止基本没有能够实现自动交付的，都是需要人为的区check交付的时机。所以CI完成之后的流程应该是，将构建产物上传之后将产物信息存储，之后等待等待人为触发发布（也就是交付任务）

### 完整流程
1. 创建代码仓库
2. 在服务器上安装gitlab-runner
3. 为项目配置Runner,(url, token, 使用docker镜像)
4. 项目根目录创建.gitlab-ci.yaml文件（配置镜像等）
5. 编写stages，jobs，when，script等字段

### 基于jenkins的CI配置

1. 在构建服务安装jenkins
2. 安装完成之后启动，会在8080端口上访问到jenkins的可视化界面
3. 安装对应的插件和配置环境（git, nodejs, npm）
4. 创建项目，添加项目地址，访问凭证
5. 创建jenkinsfile文件，配置构建任务
6. 之后jeenkins会根据jeenkinsfile定义的pipeline来构建项目

### jenkinsfile

1. pipeline 流水线配置，其下有stages，stages下有stage，stage内配置steps steps则为节点执行的命令
一般情况下，会在项目的根目录下创建一个jenkinsfile文件，用来配置项目专属的流水线。jenkins回去获取对应的配置
文件然后执行响应的流水线
