# http缓存策略
## 强缓存
- 浏览器在第一次发起请求的时候，会返回200状态码和内容，浏览器会缓存响应类容和响应头
- 再次发起请求时会先检查缓存状态（比较当前时间和cache-control中设置的max-age）,如果没有超过有效期则直接返回缓存内容（http1.1）
- 如果不支持http1.1的话则会查看expires 头是否过期，如果没过期则命中强缓存

```
强缓存依赖于响应头中的expires和cache-control设置，在没有命中强缓存的情况下，才会触发协商缓存
```
## 协商缓存
- 如果内容过期则表示强缓存没有命中之后开始协商缓存
- 浏览器向服务器发送携带请求头If-Modified-Since和If-None-Match
- 服务器在收到请求之后先判断If-None-Match的值和etag是否一致，如果一致则返回304状态码，表示资源没有修改，浏览器直接使用缓存内容
- 如果不一致则返回200状态码和新的etag
- 如果没有etag则会获取请求头If-Modified-Since和资源的最后一次修改时间做对比，如果没有失效则返回304状态码，表示资源没有修改，浏览器直接使用缓存内容
- 如果失效则返回200状态码，新的内容和资源最后一次修改的时间last-modified

## 启发式缓存

```
如果响应头没有设置任何缓存策略将会触发启发式缓存，在浏览器中启发式缓存的算法是基于响应头来计算下一次请求是否使用缓存，计算的方式是用响应头中的Data减去last-modified的时间，然后乘以0.1。也就是说如果last-modified上一次修改的时间越近则缓存时间越短，反之缓存时间越长。

计算公式（data - last-modified）* 0.1
```

## 如何设置强缓存

- http1.0设置expires响应头
- http1.1设置cache-control响应头（当值为max-age， s-maxage仅用于共享缓存优先级高于max-age，max-stale表示愿意接受过期资源但不能超过设置的时间）

## 如何设置协商缓存

- http请求头种设置cache-control ( no-cache, max-age=0,must-revalidate)

## expres和cache-control的优先级

express的优先级高于cache-control

## etag和last-modified的优先级

etag优先级高于last-modified

## etag是如何被计算出来的



## 浏览器中看到的from memory cache和from disk cache有什么区别
1. Memory Cache (from memory cache)
存储位置: 内存缓存存储在计算机的 RAM 中。
访问速度: 由于内存的访问速度远高于硬盘，因此内存缓存的读取速度非常快。
生存周期: 内存缓存通常在浏览器关闭或重新加载页面时会被清空。
用途: 主要用于暂时存储小文件，如 CSS、JavaScript 文件、图片等，以便在页面重新加载时快速访问。
特点: 内存缓存容量有限，当内存不足时，浏览器会自动清理较早缓存的资源。
2. Disk Cache (from disk cache)
存储位置: 磁盘缓存存储在硬盘上。
访问速度: 相对于内存缓存，磁盘缓存的访问速度较慢，但由于现代硬盘的速度仍然很快，因此对于大多数用户来说，这种延迟是可以接受的。
生存周期: 磁盘缓存的生存周期比内存缓存长得多，除非用户手动清理缓存或浏览器根据缓存策略自动清理。
用途: 用于存储较大的文件，如视频、音频文件等，以及那些不适合或无法放入内存缓存中的资源。
特点: 磁盘缓存容量相对较大，可以存储更多的数据。
不同行为执行缓存方式的不同
地址栏输入地址: 通常首先从磁盘缓存中查找资源，如果没有找到，则向服务器请求资源。
刷新页面 (F5): 优先使用内存缓存中的资源，如果找不到，则从磁盘缓存中查找。这是因为内存缓存中的资源是最新的，而磁盘缓存中的资源可能是之前访问时缓存的。
强制刷新 (Ctrl + F5): 不使用任何缓存，直接从服务器请求资源。这通常用于确保加载的是最新的资源。
总结
Memory Cache: 存储在内存中，访问速度快，容量有限，生存周期短。
Disk Cache: 存储在硬盘上，访问速度相对较慢，容量较大，生存周期较长。
浏览器会根据资源的大小、类型以及当前的内存状况来决定将资源存储在哪种缓存中。通常，浏览器会优先使用内存缓存中的资源，因为它们的访问速度更快，可以提高页面加载速度。当内存缓存满了或者资源过大时，浏览器会将资源存储在磁盘缓存中。